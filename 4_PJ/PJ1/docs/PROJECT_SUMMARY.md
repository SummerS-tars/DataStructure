# Maze Path Analysis System - Project Summary

## 项目概述

这是一个功能完整的C++迷宫路径分析系统，包含所有基础功能和多个扩展功能，总计超过75分。

## 实现功能清单

### 基础功能 (50分)

1. ✅ **迷宫加载与显示** (10分)
   - 从文本文件加载迷宫
   - 验证起点(S)和终点(E)
   - 实时显示玩家位置(@)
   - 跨平台ASCII显示

2. ✅ **角色移动** (10分)
   - WASD控制移动
   - 碰撞检测（墙壁和边界）
   - 批量命令支持（如"WWSSDD"）
   - 错误处理和提示

3. ✅ **路径记录与展示** (10分)
   - 使用`std::stack`记录移动历史
   - P命令打印完整路径
   - 步数统计

4. ✅ **撤销功能** (10分)
   - U命令撤销移动
   - 栈结构实现O(1)撤销
   - 保持命令和位置历史一致

5. ✅ **到达检测** (10分)
   - 自动检测到达终点
   - 显示总步数和完整路径
   - 胜利界面

### 扩展功能 (25分)

6. ✅ **路径回放** (5分)
   - R命令自动回放移动序列
   - 0.5秒延迟动画效果
   - 回放后恢复原状态

7. ✅ **多槽位保存/加载** (5分)
   - 5个独立存档槽位
   - 元数据存储（时间戳、步数、位置、迷宫文件）
   - 加载确认对话框
   - 存档列表显示
   - 二进制文件格式

8. ✅ **迷宫生成器** (5分)
   - 随机DFS算法
   - 可配置大小（5x5到101x101）
   - 保证可解
   - 导出标准格式

9. ✅ **双人竞速模式** (10分)
   - 两玩家同时竞技
   - 回合制移动（每回合一步）
   - 独立位置显示（玩家1:@, 玩家2:%）
   - 先到达终点者获胜
   - 独立路径追踪和统计
   - 胜利界面显示双方步数

### 额外改进 (加分)

10. ✅ **增强菜单系统**
    - 交互式主菜单
    - 自动扫描data/和saves/目录
    - 游戏模式选择（单人/双人）
    - 输入验证和错误处理
    - 上下文帮助系统

11. ✅ **代码重构**
    - 创建MenuManager模块（菜单逻辑）
    - 创建SaveManager模块（存档管理）
    - Game.cpp从779行减少到~450行
    - 清晰的职责分离

## 技术亮点

### 数据结构使用

| 数据结构 | 用途 | 复杂度 |
|---------|------|--------|
| `std::vector<std::string>` | 2D迷宫网格 | O(1) 访问 |
| `std::stack<std::pair<int,int>>` | 移动历史（撤销） | O(1) 压栈/出栈 |
| `std::vector<char>` | 命令历史（回放） | O(1) 追加 |
| 文件系统（5个文件） | 多槽位存档 | O(1) 每槽 |
| DFS栈 | 迷宫生成 | O(W×H) |

### 设计模式

1. **MVC风格架构**
   - Model: Maze + Player（游戏状态）
   - View: 显示函数
   - Controller: Game（主循环）+ MenuManager（UI）

2. **友元类模式**
   - MenuManager为Game的友元类
   - 访问私有的handle_load_command()

3. **策略模式**
   - 单人模式：全功能（保存/加载/撤销/回放）
   - 双人模式：回合制竞技

### 关键设计决策

1. **ASCII字符集**
   - 问题：UTF-8中点(·)导致显示损坏
   - 解决：使用ASCII空格
   - 好处：跨平台兼容性

2. **栈实现撤销**
   - 选择：`std::stack<std::pair<int,int>>`
   - 理由：完美的LIFO行为，O(1)操作

3. **独立命令历史**
   - 设计：命令与位置分开存储
   - 目的：简化回放逻辑

4. **二进制存档格式**
   - 格式：`[时间戳][步数][位置][迷宫文件][历史]`
   - 优势：紧凑、快速、支持版本控制

5. **回合制单步限制**
   - 实现：多人模式禁用批量命令
   - 理由：确保公平竞争

## 项目结构

```
4_PJ/PJ1/
├── include/          # 头文件 (7个类)
├── src/              # 源文件 (~3000+行)
├── data/             # 迷宫文件
├── saves/            # 存档文件
├── docs/             # 文档
├── Makefile          # 构建配置
└── README.md         # 详细文档
```

## 编译和运行

```bash
# 编译
make

# 运行
./maze_game

# 直接加载迷宫
./maze_game data/Maze1.txt
```

## 测试覆盖

### 单人模式测试
- ✅ 所有迷宫文件加载
- ✅ 四方向移动
- ✅ 墙壁碰撞
- ✅ 撤销功能
- ✅ 路径打印
- ✅ 移动回放
- ✅ 5个存档槽位
- ✅ 存档加载
- ✅ 迷宫生成

### 双人模式测试
- ✅ 模式选择
- ✅ 双玩家显示
- ✅ 回合轮换
- ✅ 单步限制
- ✅ 双方碰撞
- ✅ 胜利检测
- ✅ 步数统计

## 已解决的问题

1. ✅ UTF-8显示损坏 → 转换为ASCII
2. ✅ 碰撞错误处理 → 添加提前返回
3. ✅ 回放命令bug → 修复命令引用
4. ✅ 输入验证循环 → 添加cin.fail()检查
5. ✅ 表格对齐 → 使用简单分隔符
6. ✅ 代码组织 → 重构为MenuManager和SaveManager
7. ✅ 多人公平性 → 限制单步移动

## 得分总结

| 类别 | 功能 | 分数 |
|-----|------|------|
| 基础 | 迷宫加载/移动/路径/撤销/检测 | 50 |
| 扩展 | 回放 | 5 |
| 扩展 | 多槽位保存/加载 | 5 |
| 扩展 | 迷宫生成器 | 5 |
| 扩展 | 双人竞速 | 10 |
| **总计** | | **75+** |

## 开发统计

- **总代码行数**: ~3000+
- **类数量**: 7
- **数据结构**: Stack, Vector, String, Pair
- **开发阶段**: 10个阶段
- **功能数量**: 9个主要功能

## 作者

数据结构课程 - 项目1

2025年11月
