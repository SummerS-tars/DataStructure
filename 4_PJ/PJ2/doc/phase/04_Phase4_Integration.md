# Phase 4: 系统整合与扩展功能 (Integration & Extensions)

## 目标 (Goal)

将所有模块整合为完整的交互式程序，并添加Boss移动机制（动态图），完善用户体验。

## 需要实现的模块 (Modules to Implement/Modify)

| 模块名称 | 职责与目标 | 关键数据结构/算法 |
| :--- | :--- | :--- |
| **`GameSystem`** (Main) | 主控制循环。处理用户输入，调度 Map, Player, Log 模块。 | 状态机 / 交互逻辑 |
| **`BossManager`** | 实现Boss的随机移动逻辑，动态更新图节点属性。 | 动态图更新 |
| **`BattleSystem`** (Optional) | 简单的数值比对或随机数战斗逻辑。 | 模拟 |

## 实现建议 (Implementation Guidance)

1. **主菜单循环**：设计 CLI 菜单：`1. 生成新地图`, `2. 查看地图`, `3. 自动寻路(最短)`, `4. 自动寻路(最富)`, `5. 背包`, `6. 日志`, `7. 步进模式(手动/Boss移动)`。
2. **Boss 移动**：
    * 编写 `MoveBoss()` 函数。获取当前 Boss 所在房间的邻接房间列表。
    * 随机选择一个邻接房间。
    * **关键点**：更新旧房间（移除Boss标记，可能变为空或留有小怪）和新房间（标记为Boss，武力值覆盖）的状态。
    * *注意*：Boss 移动后，若玩家还未到达，需重新计算最短路径（调用 Phase 3 的 BFS）。
3. **UI 优化**：使用简单的 ASCII 字符画或格式化文本展示地图连接关系。

## 单元测试要求 (Unit Test Requirements)

* **`BossMoveTest`**: 调用移动函数后，验证 Boss 的 ID 发生了变化，且新 ID 是原 ID 的邻居。
* **`IntegrationTest`**: 模拟完整流程：生成地图 -> 规划路径 -> 执行移动 -> 获得战利品 -> 记录日志。验证所有数据状态的一致性。

## 阶段完成标识 (Phase Completion Indicator)

拥有一个可玩的游戏 Demo。玩家可以进行完整的游戏循环，且在 Boss 移动后，寻路算法依然能给出正确的实时反馈。

在课堂检查时，讲解不同部分数据结构的设计，演示程序运⾏，并讲解⾃⼰对该程序的设计与优化。  
