# PJ2 性能与可用性优化建议

本文件汇总当前项目在性能、可维护性以及可用性方面的可行优化方向，分为“短期易实施”和“中长期提升”两类，便于按阶段推进。

## 短期易实施

- 随机生成稳定性：在 `GenConfig` 中统一暴露并记录随机种子（已在 GameSystem 中使用），在保存地图时额外保存 `seed`，便于复现实验与回归测试。
- I/O 友好性：
    - `DungeonMap::to_string()` 输出中对房间按 id 排序，便于对比文本差异。
    - CLI 菜单增加输入校验与重复提示，减少因非法输入导致的中断。
- 路径搜索限额：`find_all_paths_sorted` 默认 `max_paths=200`，可在 CLI 中提供参数配置，防止在高连通图中过多 DFS 造成延迟。
- 结构化日志：`AdventureLog` 支持导出到文件（JSON/CSV），便于统计与可视化；打印时提供“仅失败/仅成功/全部”筛选。
- 逻辑复用：`GameSystem::action_shortest_path()` 与 `action_explore_with_battle()` 对 start/goal 的选择抽象成函数，便于未来支持自定义起点/终点。

## 中长期提升

- 战斗系统：
    - 引入状态（护甲、暴击、药水），将战斗抽象为独立模块与可配置规则（表驱动），支持单元测试。
    - 引入“资源消耗/恢复”机制与房间事件（陷阱、回复点），与路径评价函数联动。
- 路径搜索优化：
    - 在 `evaluate_path` 中加入可行性剪枝（当前已支持 `initial_power`），并在 DFS 过程中早停。
    - 引入 A* 或 0-1 BFS 等，更高效地计算到 Boss 的最短/最优路径；对“价值-风险”进行双目标（Pareto）筛选。
    - 使用位集或压缩 visited 表示提升 DFS 性能。
- 数据持久化：
    - `DungeonMap::save/load` 增加版本号与校验，保证兼容性；支持二进制格式以降低 I/O 体积。
    - 增加独立的 `SaveGame`（含玩家状态、背包、收藏、日志、地图种子等），实现完整的读档/存档。
- 可视化与可用性：
    - 加入 ASCII 地图预览（层次布局或 BFS 层级），直观展示 Boss、怪物强度与边。
    - 增加“自动探索”演示（按最短路径或最高价值路径），显示回放与战斗记录。
- 工程化：
    - 引入 `ctest` 或 `doctest`/`Catch2` 进行更系统的单测与覆盖率统计。
    - 将公共模块划分静态库，明确头/源依赖，加速增量编译。

## 质量基线（当前状态）

- 构建：Makefile 提供 debug/release/run/test 目标，已通过本地用例。
- 测试：Phase1–4 的核心功能测试通过；交互式入口切换为 `GameSystem::run()`，启动时自动生成并打印地图，保持向后兼容的输出（含 BossRoom 与 Connected）。
- 文档：分阶段 summary 已更新，本文件补充优化路线图。

## 后续建议

- 将以上“短期易实施”项逐步落地，并同步扩展测试覆盖；完成后再推进“中长期提升”。
